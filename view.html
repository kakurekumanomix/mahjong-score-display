<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éº»é›€ç‚¹æ•°è¡¨ç¤ºãƒšãƒ¼ã‚¸ã«ã‚ƒ</title>

  <!-- Firebase SDK (ãƒãƒ¼ã‚¸ãƒ§ãƒ³8ç³»ã®ãƒ–ãƒ©ã‚¦ã‚¶ç”¨) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    .container {
      display: grid;
      grid-template-areas: 
        "up up up"
        "left center right"
        "down down down";
      grid-gap: 20px;
      text-align: center;
      margin-top: 50px;
    }
    .up { grid-area: up; }
    .left { grid-area: left; }
    .right { grid-area: right; }
    .down { grid-area: down; }
    .center { grid-area: center; }
    .image-container {
      text-align: center;
      margin-top: 0px;
      
    }
    img {
      width: 400px; /* ç”»åƒã®å¹…ã‚’400pxã«èª¿æ•´ */
      height: auto; /* è‡ªå‹•ã§é«˜ã•ã‚’èª¿æ•´ã—ã€ç¸¦æ¨ªæ¯”ã‚’ç¶­æŒ */
    }
    .reset-button-container {
      margin-top: 20px;
      text-align: center;
    }

    
       /* ãƒ—ãƒ©ã‚¹ã¯é’ã€ãƒã‚¤ãƒŠã‚¹ã¯èµ¤ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .positive { color: blue; }
    .negative { color: red; }

    

     /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾© */
    @keyframes score-change {
      from {
        opacity: 0;
        transform: scale(1.2);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .score-change {
      animation: score-change 0.5s ease-in-out;
    }

/* æ›´æ–°ãƒœã‚¿ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
    .update-button-container {
      margin-top: 20px; /* ãƒœã‚¿ãƒ³ã‚’ã•ã‚‰ã«ä¸‹ã«é…ç½® */
    }
    
    /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã¨å±¥æ­´è¡¨ç¤ºãƒœã‚¿ãƒ³ã‚’ãƒ•ãƒ¬ãƒƒã‚¯ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã« */
    .button-container {
      display: flex;
      flex-direction: column; /* ãƒœã‚¿ãƒ³ã‚’ç¸¦æ–¹å‘ã«é…ç½® */
      align-items: center; /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®æƒãˆ */
      gap: 1px; /* ãƒœã‚¿ãƒ³é–“ã®éš™é–“ã‚’èª¿æ•´ */
      margin-top:  40px;
    }


    button {
  width: auto; /* å¿…è¦ã«å¿œã˜ã¦autoã‚„å›ºå®šå€¤ã«å¤‰æ›´ */
  height: 40px; /* ãƒœã‚¿ãƒ³ã®é«˜ã•ã‚’å›ºå®š */
  padding: 10px 20px; /* ãƒœã‚¿ãƒ³å†…ã®ä½™ç™½ã‚’èª¿æ•´ */
  font-size: 16px; /* ãƒ†ã‚­ã‚¹ãƒˆã®å¤§ãã•ã‚’èª¿æ•´ */
  border-radius: 5px; /* è§’ã‚’ä¸¸ã‚ãŸã„å ´åˆ */
  text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¸­å¤®ã« */
  background-color: #4CAF50; /* ãƒœã‚¿ãƒ³ã®èƒŒæ™¯è‰² */
  color: white; /* ãƒœã‚¿ãƒ³ã®æ–‡å­—è‰² */
  margin-top:  10px;/
}

button:active {
  background-color: #45a049; /* æŠ¼ã—ãŸã¨ãã®ãƒœã‚¿ãƒ³ã®è‰² */
}
    
    .reset-button-container {
  text-align: left; /* ãƒœã‚¿ãƒ³ã‚’å·¦å¯„ã› */
  width: 100%; /* ãƒœã‚¿ãƒ³ãŒå·¦å¯„ã›ã•ã‚Œã‚‹ã‚ˆã†ã«å¹…ã‚’æŒ‡å®š */
}

    .history-button-container {
  text-align: left; /* ãƒœã‚¿ãƒ³ã‚’å·¦å¯„ã› */
  width: 100%; /* ãƒœã‚¿ãƒ³ãŒå·¦å¯„ã›ã•ã‚Œã‚‹ã‚ˆã†ã«å¹…ã‚’æŒ‡å®š */
}
     .reset-button-container,
    .history-button-container {
      margin-top: 0; /* ä½™ç™½ã‚’0ã« */
    }

    /* ãƒ—ãƒ©ã‚¹ãƒã‚¤ãƒŠã‚¹ã¨ç‚¹æ•°å…¥åŠ›ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª¿æ•´ */
select {
  font-size: 14px; /* ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã‚’å¤§ãã */
  padding: 5px; /* å†…å´ã®ä½™ç™½ã‚’å¤§ããã—ã¦é¸æŠè‚¢ã‚’è¦‹ã‚„ã™ã */
  width: auto; /* å¿…è¦ã«å¿œã˜ã¦autoã‚„å›ºå®šå¹…ã«å¤‰æ›´ */
  height: 30px; /* é«˜ã•ã‚’å¤§ããèª¿æ•´ */
  border-radius: 5px; /* è§’ã‚’ä¸¸ã‚ã‚‹ */
}
    
  </style>
</head>
<body>
  <h1>éº»é›€ç‚¹æ•°è¡¨ç¤ºãƒšãƒ¼ã‚¸ã«ã‚ƒğŸ€„</h1>

  
  <!-- å±€é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
<div class="round-selection" style="text-align: center; margin-top: 20px;">
  <label for="roundSelect">å±€ã‚’é¸æŠã™ã‚‹ã«ã‚ƒ:</label>
  <select id="roundSelect">
    <option value="æ±1">æ±1</option>
    <option value="æ±2">æ±2</option>
    <option value="æ±3">æ±3</option>
    <option value="æ±4">æ±4</option>
    <option value="å—1">å—1</option>
    <option value="å—2">å—2</option>
    <option value="å—3">å—3</option>
    <option value="å—4">å—4</option>
  </select>
</div>

<!-- æœ¬å ´é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
<div class="honba-selection" style="text-align: center; margin-top: 10px;">
  <label for="honbaSelect">æœ¬å ´ã‚’é¸æŠã™ã‚‹ã«ã‚ƒ:</label>
  <select id="honbaSelect">
    <option value="0" selected>0æœ¬å ´</option>
    <option value="1">1æœ¬å ´</option>
    <option value="2">2æœ¬å ´</option>
    <option value="3">3æœ¬å ´</option>
    <option value="4">4æœ¬å ´</option>
    <option value="5">5æœ¬å ´</option>
    <option value="6">6æœ¬å ´</option>
    <option value="7">7æœ¬å ´</option>
    <option value="8">8æœ¬å ´</option>
    <option value="9">9æœ¬å ´</option>
  </select>
</div>


  
  <!-- ãƒ¦ãƒ¼ã‚¶åã¨ç‚¹æ•°ã®å¤‰æ›´ãŒå¯èƒ½ãªãƒ•ã‚©ãƒ¼ãƒ  -->
  <form id="scoreForm" class="container">
    <div class="up">
      <label id="player1Label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1</label>: <span id="player1CurrentScore">æœªè¨­å®š</span>ç‚¹
      <br>
      <input type="text" id="player1NameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´ã™ã‚‹ã«ã‚ƒ">
      <br><br>
      <select id="player1Sign">
        <option value="1">ãƒ—ãƒ©ã‚¹</option>
        <option value="-1">ãƒã‚¤ãƒŠã‚¹</option>
      </select>
      <select id="player1Change" class="scoreChange" required>
        <option value="0" selected>0</option>
        <script>
          for (let i = 100; i <= 50000; i += 100) {
            document.write('<option value="' + i + '">' + i + '</option>');
          }
        </script>
      </select><br>
    </div>

    <div class="left">
      <label id="player3Label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3</label>: <span id="player3CurrentScore">æœªè¨­å®š</span>ç‚¹
      <br>
      <input type="text" id="player3NameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´ã™ã‚‹ã«ã‚ƒ">
      <br><br>
      <select id="player3Sign">
        <option value="1">ãƒ—ãƒ©ã‚¹</option>
        <option value="-1">ãƒã‚¤ãƒŠã‚¹</option>
      </select>
       <select id="player3Change" class="scoreChange" required>
        <option value="0" selected>0</option>
        <script>
          for (let i = 100; i <= 50000; i += 100) {
            document.write('<option value="' + i + '">' + i + '</option>');
          }
        </script>
      </select><br>
    </div>

    <div class="right">
      <label id="player4Label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4</label>: <span id="player4CurrentScore">æœªè¨­å®š</span>ç‚¹
      <br>
      <input type="text" id="player4NameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´ã™ã‚‹ã«ã‚ƒ">
      <br><br>
      <select id="player4Sign">
        <option value="1">ãƒ—ãƒ©ã‚¹</option>
        <option value="-1">ãƒã‚¤ãƒŠã‚¹</option>
      </select>
      <select id="player4Change" class="scoreChange" required>  
        <option value="0" selected>0</option>
        <script>
          for (let i = 100; i <= 50000; i += 100) {
            document.write('<option value="' + i + '">' + i + '</option>');
          }
        </script>
      </select><br>
    </div>

    <div class="down">
      <label id="player2Label">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2</label>: <span id="player2CurrentScore">æœªè¨­å®š</span>ç‚¹
      <br>
      <input type="text" id="player2NameInput" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã‚’å¤‰æ›´ã™ã‚‹ã«ã‚ƒ">
      <br><br>
      <select id="player2Sign">
        <option value="1">ãƒ—ãƒ©ã‚¹</option>
        <option value="-1">ãƒã‚¤ãƒŠã‚¹</option>
      </select>
      <select id="player2Change" class="scoreChange" required>
        <option value="0" selected>0</option>
        <script>
          for (let i = 100; i <= 50000; i += 100) {
            document.write('<option value="' + i + '">' + i + '</option>');
          }
        </script>
      </select><br>
    

   
<!-- æ›´æ–°ãƒœã‚¿ãƒ³ -->
  <div class="update-button-container">
      <button type="submit" id="updateButton">æ›´æ–°ã«ã‚ƒ</button>
    </div>
    </div>
</form>

<div class="button-container">
    <div class="reset-button-container">
      <button id="resetButton">ç‚¹æ•°ãƒªã‚»ãƒƒãƒˆã«ã‚ƒ</button>
    </div>
    <div class="history-button-container">
      <a href="history.html">
        <button id="historyButton">å±¥æ­´è¡¨ç¤ºã«ç§»å‹•ã™ã‚‹ã«ã‚ƒ(ä½œæˆä¸­ã«ã‚ƒ...)</button>
      </a>
    </div>
  </div>
  
  <!-- ç”»é¢ä¸‹éƒ¨ã«ç”»åƒã‚’åŸ‹ã‚è¾¼ã‚€ -->
  <div class="image-container">
   <img src="public/images/myimage.png" alt="éº»é›€ã®ã‚¤ãƒ©ã‚¹ãƒˆ">
  </div>

  <script>
    // Firebaseã®è¨­å®š
    const firebaseConfig = {
  apiKey: "AIzaSyAwKSRmulxjrdKPFl4ypueUBQp2sOxdHCU",
  authDomain: "majan-786e2.firebaseapp.com",
  projectId: "majan-786e2",
  storageBucket: "majan-786e2.appspot.com",
  messagingSenderId: "571476331928",
  appId: "1:571476331928:web:63b9707601866ca2432fed"
    };

    // Firebaseã‚’åˆæœŸåŒ–
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    
    let currentScores = {
      player1: 25000,
      player2: 25000,
      player3: 25000,
      player4: 25000
    };

     // å¢—æ¸›ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®è‰²å¤‰æ›´
    document.querySelectorAll('.scoreChange').forEach(function(selectElement) {
      const signSelect = selectElement.previousElementSibling;
      
      signSelect.addEventListener('change', function() {
        if (signSelect.value == "1") {
          selectElement.classList.remove('negative');
          selectElement.classList.add('positive');
        } else {
          selectElement.classList.remove('positive');
          selectElement.classList.add('negative');
        }
      });
    });

    // Firestoreã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–ã—ã¦è¡¨ç¤º
    db.collection('scores').doc('current').onSnapshot((doc) => {
      if (doc.exists) {
        const data = doc.data();

        const player1ScoreElement = document.getElementById('player1CurrentScore');
        const previousPlayer1Score = parseInt(player1ScoreElement.innerText, 10);

        if (data.player1 !== undefined && data.player1 !== previousPlayer1Score) {
          player1ScoreElement.innerText = data.player1;
          player1ScoreElement.classList.add('score-change');
          setTimeout(() => {
            player1ScoreElement.classList.remove('score-change');
          }, 500);
        }

         // åŒæ§˜ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç‚¹æ•°ã«ã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
        const player2ScoreElement = document.getElementById('player2CurrentScore');
        const previousPlayer2Score = parseInt(player2ScoreElement.innerText, 10);

        if (data.player2 !== undefined && data.player2 !== previousPlayer2Score) {
          player2ScoreElement.innerText = data.player2;
          player2ScoreElement.classList.add('score-change');
          setTimeout(() => {
            player2ScoreElement.classList.remove('score-change');
          }, 500);
        }

         // åŒæ§˜ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç‚¹æ•°ã«ã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
        const player3ScoreElement = document.getElementById('player3CurrentScore');
        const previousPlayer3Score = parseInt(player3ScoreElement.innerText, 10);

        if (data.player3 !== undefined && data.player3 !== previousPlayer3Score) {
          player3ScoreElement.innerText = data.player3;
          player3ScoreElement.classList.add('score-change');
          setTimeout(() => {
            player3ScoreElement.classList.remove('score-change');
          }, 500);
        }

         // åŒæ§˜ã«ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç‚¹æ•°ã«ã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é©ç”¨
        const player4ScoreElement = document.getElementById('player4CurrentScore');
        const previousPlayer4Score = parseInt(player4ScoreElement.innerText, 10);

        if (data.player4 !== undefined && data.player4 !== previousPlayer4Score) {
          player4ScoreElement.innerText = data.player4;
          player4ScoreElement.classList.add('score-change');
          setTimeout(() => {
            player4ScoreElement.classList.remove('score-change');
          }, 500);
        }

        // Firestoreã‹ã‚‰å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶åã¨ç‚¹æ•°ã‚’è¡¨ç¤º
        document.getElementById('player1Label').innerText = data.player1Name || 'æœªè¨­å®š';
        document.getElementById('player2Label').innerText = data.player2Name || 'æœªè¨­å®š';
        document.getElementById('player3Label').innerText = data.player3Name || 'æœªè¨­å®š';
        document.getElementById('player4Label').innerText = data.player4Name || 'æœªè¨­å®š';

        document.getElementById('player1CurrentScore').innerText = data.player1 !== undefined ? data.player1 : 'æœªè¨­å®š';
        document.getElementById('player2CurrentScore').innerText = data.player2 !== undefined ? data.player2 : 'æœªè¨­å®š';
        document.getElementById('player3CurrentScore').innerText = data.player3 !== undefined ? data.player3 : 'æœªè¨­å®š';
        document.getElementById('player4CurrentScore').innerText = data.player4 !== undefined ? data.player4 : 'æœªè¨­å®š';

        currentScores.player1 = data.player1 || 25000;
        currentScores.player2 = data.player2 || 25000;
        currentScores.player3 = data.player3 || 25000;
        currentScores.player4 = data.player4 || 25000;
      } else {
        console.log('ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    }, (error) => {
      console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿å–ã‚Šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ", error);
    });

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    const form = document.getElementById('scoreForm');
    form.addEventListener('submit', function(event) {
      event.preventDefault();

      const player1Name = document.getElementById('player1NameInput').value || document.getElementById('player1Label').innerText;
      const player2Name = document.getElementById('player2NameInput').value || document.getElementById('player2Label').innerText;
      const player3Name = document.getElementById('player3NameInput').value || document.getElementById('player3Label').innerText;
      const player4Name = document.getElementById('player4NameInput').value || document.getElementById('player4Label').innerText;

      const player1Change = parseInt(document.getElementById('player1Sign').value) * parseInt(document.getElementById('player1Change').value);
      const player2Change = parseInt(document.getElementById('player2Sign').value) * parseInt(document.getElementById('player2Change').value);
      const player3Change = parseInt(document.getElementById('player3Sign').value) * parseInt(document.getElementById('player3Change').value);
      const player4Change = parseInt(document.getElementById('player4Sign').value) * parseInt(document.getElementById('player4Change').value);

      const round = document.getElementById('roundSelect').value; // é¸æŠã•ã‚ŒãŸå±€
      const honba = document.getElementById('honbaSelect').value; // é¸æŠã•ã‚ŒãŸæœ¬å ´


      
      currentScores.player1 += player1Change;
      currentScores.player2 += player2Change;
      currentScores.player3 += player3Change;
      currentScores.player4 += player4Change;

      // Firestoreã«ãƒ¦ãƒ¼ã‚¶åã¨ç‚¹æ•°ã‚’æ›´æ–°
      db.collection('scores').doc('current').set({
        player1Name: player1Name,
        player2Name: player2Name,
        player3Name: player3Name,
        player4Name: player4Name,
        player1: currentScores.player1,
        player2: currentScores.player2,
        player3: currentScores.player3,
        player4: currentScores.player4
      }, { merge: true }).then(() => {
        alert('ãƒ¦ãƒ¼ã‚¶åã¨ç‚¹æ•°ãŒæ›´æ–°ã•ã‚ŒãŸã«ã‚ƒï¼');
        
 // ç‚¹æ•°ã®å¢—æ¸›ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
    document.getElementById('player1Change').value = '0'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ç‚¹æ•°å¢—æ¸›ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('player2Change').value = '0'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ç‚¹æ•°å¢—æ¸›ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('player3Change').value = '0'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3ã®ç‚¹æ•°å¢—æ¸›ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('player4Change').value = '0'; // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4ã®ç‚¹æ•°å¢—æ¸›ãƒªã‚»ãƒƒãƒˆ
        
        
      }).catch((error) => {
        console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã«ã‚ƒ:', error);
      });

      // Firestoreã«å±¥æ­´ã‚’ä¿å­˜ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
  db.collection('history').add({
    player1Change: player1Change,
    player2Change: player2Change,
    player3Change: player3Change,
    player4Change: player4Change,
    round: round,  // å±€æƒ…å ±
    honba: honba,  // æœ¬å ´æƒ…å ±
    timestamp: firebase.firestore.FieldValue.serverTimestamp() // ç¾åœ¨ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä¿å­˜
  }).then(() => {
    console.log("å±¥æ­´ãŒä¿å­˜ã•ã‚ŒãŸã«ã‚ƒï¼");
  }).catch((error) => {
    console.error("å±¥æ­´ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã«ã‚ƒ: ", error);
  });
});

    // ç‚¹æ•°ãƒªã‚»ãƒƒãƒˆå‡¦ç†
    const resetButton = document.getElementById('resetButton');
    resetButton.addEventListener('click', function() {
      currentScores = {
        player1: 25000,
        player2: 25000,
        player3: 25000,
        player4: 25000
      };

      // Firestoreã«ãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸç‚¹æ•°ã‚’ä¿å­˜
      db.collection('scores').doc('current').set({
        player1: currentScores.player1,
        player2: currentScores.player2,
        player3: currentScores.player3,
        player4: currentScores.player4
      }, { merge: true }).then(() => {
        alert('ç‚¹æ•°ãŒãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸã«ã‚ƒï¼');
      }).catch((error) => {
        console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã«ã‚ƒ:', error);
      });
    });
  </script>
</body>
</html>
